<!DOCTYPE html>
<html>
<head> @include('./header.html', { "title": "23" })
    <style>
        html,body{
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="mianBox">
        <div class="box">
            <div class="pic">
                <img src="dist/img/1.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/2.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/3.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/4.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/5.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/6.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/7.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/8.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/9.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/1.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/2.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/3.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/4.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/5.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/6.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/7.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/8.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/9.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/1.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/2.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/3.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/4.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/5.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/6.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/7.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/8.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/9.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/1.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/2.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/3.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/4.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/5.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/6.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/7.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/8.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/9.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/1.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/2.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/3.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/4.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/5.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/6.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/7.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/8.jpg" alt="">
            </div>
        </div>
        <div class="box">
            <div class="pic">
                <img src="dist/img/9.jpg" alt="">
            </div>
        </div>
    </div>
</body>
<script src="dist/js/lib/jquery/jquery-1.11.3.min.js"></script>
<script>
    window.onload = function () {
        //1、实现布局
        waterFull("mianBox","box");

        //2、动态加载图片
        window.onscroll = function () {
            if (checkWillLoadImg) {
                //造数据
                var dataArr = [
                    {"src":"img/1.jpg"},
                    {"src":"img/5.jpg"},
                    {"src":"img/3.jpg"},
                    {"src":"img/4.jpg"},
                    {"src":"img/5.jpg"},
                    {"src":"img/6.jpg"},
                    {"src":"img/7.jpg"},
                    {"src":"img/1.jpg"},
                    {"src":"img/6.jpg"},
                    {"src":"img/9.jpg"},
                    {"src":"img/4.jpg"},
                    {"src":"img/2.jpg"},
                    {"src":"img/8.jpg"},
                ];
                //创建元素
                for (var i = 0; i < dataArr.length; i++){
                    var newBox = document.createElement("div");
                    newBox.className = "box";
                    $("mianBox").appendChild(newBox);

                    var newPic = document.createElement("div");
                    newPic.className = "pic";
                    newBox.appendChild(newPic);

                    var newImg = document.createElement("img");
                    newImg.src = "dist/"+dataArr[i].src;
                    newPic.appendChild(newImg);
                }
                //重新布局
                waterFull("mianBox","box");
            }
        }
    };
    function waterFull(parent,child){
        //父盒子居中
        var allbox = $(parent).getElementsByClassName(child);
        //获取子盒子的宽度
        var boxWidth = allbox[0].offsetWidth;
        //获取屏幕的宽度
        var screenWidth = document.documentElement.clientWidth;
        //求出列数
        var cols = parseInt(screenWidth / boxWidth);
        $(parent).style.width = cols*boxWidth + "px";
        $(parent).style.margin = "0 auto";

        //子盒子定位
        var heigthArr = [];
        var boxHeight = 0;
        var minBioxHeight = 0;
        var minBoxIndex = 0;
        for (var i = 0; i < allbox.length; i++){
            boxHeight = allbox[i].offsetHeight;
            if (i < cols){
                heigthArr.push(boxHeight);
            } else {
                //取出最矮盒子高度
                minBioxHeight = Math.min.apply(this,heigthArr);
                //求出最矮盒子对应的索引
                minBoxIndex = getMinBoxIndex(heigthArr,minBioxHeight);
                //子盒子定位
                allbox[i].style.position = "absolute";
                allbox[i].style.left = minBoxIndex*boxWidth + "px";
                allbox[i].style.top = minBioxHeight + "px";
                //更新数组中的高度
                heigthArr[minBoxIndex] += boxHeight;
            }
        }
        console.log(minBioxHeight,minBoxIndex);
    }
    function getMinBoxIndex(arr,val){
        for (var i = 0; i < arr.length; i++){
            if(arr[i] === val){
                return i;
            }
        }
    }
    /*
    * 判断是否具备加载图片的条件
    * */
    function checkWillLoadImg(){
        //获取最后一个盒子
        var allBox = document.getElementsByClassName("box");
        var lastBox = allBox[allBox.length - 1];
        //求出最后一个盒子自身高度的一半 + 头部偏离高度（offsetTop）
        var lastBoxDis = lastBox.offsetHeight / 2 + lastBox.offsetTop;
        //求出屏幕的高度
        var screenH = document.body.clientHeight || document.documentElement.clientHeight;
        //求出页面偏离浏览器的高度
        var scrollTop = document.documentElement.scrollTop;
        console.log(lastBoxDis,screenH,scrollTop);
        return lastBoxDis <= screenH + scrollTop;
    }
    function $(id) {
        return typeof id === "string" ? document.getElementById(id) : null;
    }
</script>

</html>









